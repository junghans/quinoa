<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Quinoa: /tmp/q/quinoa/src/LinSys/LinSysMerger.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="quinoa.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Quinoa
   </div>
   <div id="projectbrief">Adaptive computational fluid dynamics</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Documents</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_lin_sys_merger_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a> &#124;
<a href="#define-members">Macros</a>  </div>
  <div class="headertitle">
<div class="title">LinSysMerger.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Charm++ chare linear system merger group to solve a linear system.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;vector&gt;</code><br />
<code>#include &lt;map&gt;</code><br />
<code>#include &lt;unordered_map&gt;</code><br />
<code>#include &lt;utility&gt;</code><br />
<code>#include &lt;numeric&gt;</code><br />
<code>#include &lt;algorithm&gt;</code><br />
<code>#include &lt;iosfwd&gt;</code><br />
<code>#include &lt;cstddef&gt;</code><br />
<code>#include &quot;Types.h&quot;</code><br />
<code>#include &quot;<a class="el" href="_exception_8h_source.html">Exception.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_container_util_8h_source.html">ContainerUtil.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_p_u_p_util_8h_source.html">PUPUtil.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_fields_8h_source.html">Fields.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_hypre_matrix_8h_source.html">HypreMatrix.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_hypre_vector_8h_source.html">HypreVector.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_hypre_solver_8h_source.html">HypreSolver.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_vector_reducer_8h_source.html">VectorReducer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_hash_map_reducer_8h_source.html">HashMapReducer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_aux_solver_8h_source.html">AuxSolver.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="linsysmerger_8decl_8h_source.html">NoWarning/linsysmerger.decl.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="transporter_8decl_8h_source.html">NoWarning/transporter.decl.h</a>&quot;</code><br />
<code>#include &quot;linsysmerger.def.h&quot;</code><br />
</div>
<p><a href="_lin_sys_merger_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtk_1_1_lin_sys_merger.html">tk::LinSysMerger&lt; HostProxy, WorkerProxy, AuxSolver &gt;</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacetk"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacetk.html">tk</a></td></tr>
<tr class="memdesc:namespacetk"><td class="mdescLeft">&#160;</td><td class="mdescRight">Toolkit declarations and definitions for general purpose utilities. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a6ec0c67374eb34a66c0f5ca4ecd7d163"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_lin_sys_merger_8h.html#a6ec0c67374eb34a66c0f5ca4ecd7d163">CK_TEMPLATES_ONLY</a></td></tr>
<tr class="separator:a6ec0c67374eb34a66c0f5ca4ecd7d163"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Charm++ chare linear system merger group to solve a linear system. </p>
<dl class="section author"><dt>Author</dt><dd>J. Bakosi </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Fri 14 Oct 2016 12:24:23 PM MDT </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2012-2015, Jozsef Bakosi, 2016, Los Alamos National Security, LLC.</dd></dl>
<p>Charm++ chare linear system merger group used to collect and assemble the left hand side matrix (lhs), the right hand side (rhs) vector, and the solution (unknown) vector from individual worker (e.g., Carrier) chares. Beside collection and assembly, the system is also solved. The solution is outsourced to hypre, an MPI-only library. Once the solution is available, the individual worker chares are updated with the new solution.</p>
<p>In the basic configuration this class assembles and solves a single linear system, whose rhs vector may change during time stepping. In a more advanced configuration, an additional, auxiliary, linear system can also be solved. The basic configuration is configured by instantiating this class using the AuxSolver = AuxSolverNull template argument, while the one that solves the auxiliary system is configured by an AuxSolver class that provides a number of member functions. For possible auxiliary solver classes, see, e.g., <a class="el" href="_aux_solver_8h.html" title="Auxiliary solvers used in tk::LinSysMerger by inciter. ">src/Inciter/AuxSolver.h</a>.</p>
<p>When LinSysMerger is configured to solve an auxiliary solution beside its primary solution, the class behind the AuxSolver template argument, must have static member functions only, which may provide the necessary functionality to collect, assemble, solve, and update an auxiliary linear system. The requirements on the auxiliary linear system are: (1) the left hand side matrix must be diagonal, (2) the right hand side vector is (optionally) a combination of the primary right hand side vector and another vector, assembled separately (and overlapped with the primary system). This enables configuring the auxiliary system to be, e.g., the low order solution as required by the flux-corrected transport algorithm used for transport equations in inciter. However, it also enables entirely removing the auxiliary solution from LinSysMerger, via <a class="el" href="classinciter_1_1_aux_solver_null.html" title="AuxSolverNull: No auxiliary solver (unused for now) ">inciter::AuxSolverNull</a>. Tthe Charm++ SDAG logic does not change depending on whether an auxiliary solution is performed or not. The composition is done at compile time, depending on how LinSysMerger is instantiated.</p>
<p>The implementation uses the Charm++ runtime system and is fully asynchronous, overlapping computation and communication. The algorithm utilizes the structured dagger (SDAG) Charm++ functionality. The high-level overview of the algorithm structure and how it interfaces with Charm++ is discussed in the Charm++ interface file <a class="el" href="linsysmerger_8ci.html">src/LinSys/linsysmerger.ci</a>. Note that the SDAG logic is the same regardless whether an auxiliary solution is performed.</p>
<h4>Call graph</h4>
<p>The following is a directed acyclic graph (DAG) that outlines the asynchronous algorithm implemented in this class The detailed discussion of the algorithm is given in the Charm++ interface file <a class="el" href="linsysmerger_8ci.html">linsysmerger.ci</a>. On the DAG orange fills denote global synchronization points that contain or eventually lead to global reductions. Dashed lines are potential shortcuts that allow jumping over some of the task-graph under some circumstances or optional code paths (taken, e.g., only in DEBUG mode). See the detailed discussion in linsysmrger.ci. </p><div align="center">
<iframe scrolling="no" frameborder="0" src="dot_inline_dotgraph_4.svg" width="1247" height="547"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
 <div class="fragment"><div class="line">// *****************************************************************************</div><div class="line">/*!</div><div class="line">  \file      src/LinSys/linsysmerger.ci</div><div class="line">  \author    J. Bakosi</div><div class="line">  \date      Fri 14 Oct 2016 12:22:54 PM MDT</div><div class="line">  \copyright 2012-2015, Jozsef Bakosi, 2016, Los Alamos National Security, LLC.</div><div class="line">  \brief     Charm++ module interface file for merging a linear system</div><div class="line">  \details   Charm++ module interface file for merging a linear system. See more</div><div class="line">     in src/LinSys/LinSysMerger.h.</div><div class="line">*/</div><div class="line">// *****************************************************************************</div><div class="line"></div><div class="line">module linsysmerger {</div><div class="line"></div><div class="line">  include &quot;unordered_map&quot;;</div><div class="line"></div><div class="line">  extern module transporter;</div><div class="line"></div><div class="line">  namespace tk {</div><div class="line"></div><div class="line">    // List all possible specializations of templated chare to instantiate</div><div class="line">    // registration and delivery of code for the individual specializations</div><div class="line"></div><div class="line">    // Will specialize linear system merger for Transporter &amp; Carrier</div><div class="line">    chare LinSysMerger&lt; inciter::CProxy_Transporter,</div><div class="line">                        inciter::CProxy_Carrier,</div><div class="line">                        inciter::AuxSolverLumpMassDiff &gt;;</div><div class="line"></div><div class="line">    // LinSysMerger is templated so that the same code (parameterized by the</div><div class="line">    // type given by the template arguments, HostProxy and WorkerProxy) can be</div><div class="line">    // generated for different types of proxies. Howver, all possible</div><div class="line">    // specializations must be listed above to ensure that Charm++ generates</div><div class="line">    // correct code.</div><div class="line">    template&lt; class HostProxy, class WorkerProxy, class AuxSolver &gt;</div><div class="line">    group LinSysMerger {</div><div class="line">      entry LinSysMerger( const HostProxy&amp; host,</div><div class="line">                          const WorkerProxy&amp; worker,</div><div class="line">                          const std::map&lt; int,</div><div class="line">                            std::vector&lt; std::size_t &gt; &gt;&amp; side,</div><div class="line">                          std::size_t ncomp );</div><div class="line">      initnode void registerBCMerger();</div><div class="line">      entry void bounds( int pe, std::size_t lower, std::size_t upper );</div><div class="line">      entry void enable_wait4rhs();</div><div class="line">      entry void addrow( int fromch,</div><div class="line">                         int frompe,</div><div class="line">                         const std::set&lt; std::size_t &gt;&amp; row );</div><div class="line">      entry void recrow();</div><div class="line">      entry [reductiontarget] void addbc( CkReductionMsg* msg );</div><div class="line">      entry void oldID( int fromch, const std::vector&lt; std::size_t &gt;&amp; oldids );</div><div class="line">      entry void charebcval( const std::unordered_map&lt; std::size_t,</div><div class="line">                            std::vector&lt; std::pair&lt; bool, tk::real &gt; &gt; &gt;&amp; bcv );</div><div class="line">      entry [reductiontarget] void comlhsbc( CkReductionMsg* msg );</div><div class="line">      entry void vercomplete();</div><div class="line">      entry void addsol( int fromch,</div><div class="line">                         const std::map&lt; std::size_t,</div><div class="line">                                         std::vector&lt; tk::real &gt; &gt;&amp; sol );</div><div class="line">      entry void addlhs( int fromch,</div><div class="line">        const std::map&lt; std::size_t,</div><div class="line">                        std::map&lt; std::size_t,</div><div class="line">                                  std::vector&lt; tk::real &gt; &gt; &gt;&amp; lhs );</div><div class="line">      entry void addrhs( int fromch,</div><div class="line">                         const std::map&lt; std::size_t,</div><div class="line">                                         std::vector&lt; tk::real &gt; &gt;&amp; rhs );</div><div class="line">      entry void addauxrhs( int fromch,</div><div class="line">                            const std::map&lt; std::size_t,</div><div class="line">                                            std::vector&lt; tk::real &gt; &gt;&amp; auxrhs );</div><div class="line">      entry void addauxlhs( int fromch,</div><div class="line">                            const std::map&lt; std::size_t,</div><div class="line">                                            std::vector&lt; tk::real &gt; &gt;&amp; auxlhs );</div><div class="line">      entry void rowsreceived();</div><div class="line"></div><div class="line">      // SDAG code follows. See http://charm.cs.illinois.edu/manuals/html/</div><div class="line">      // charm++/manual.html, Sec. &quot;Structured Control Flow: Structured Dagger&quot;.</div><div class="line"></div><div class="line">      // High-level overview of the dependency and asynchronous call structure</div><div class="line">      // ---------------------------------------------------------------------</div><div class="line">      //</div><div class="line">      // Directed Acyclic Graph (DAG):</div><div class="line">      // -----------------------------</div><div class="line">      //</div><div class="line">      // See src/LinSys/LinSysMerger.h.</div><div class="line">      //</div><div class="line">      // Interpretation of the DAG in src/LinSys/LinSysMerger.h</div><div class="line">      // ------------------------------------------------------</div><div class="line">      // Control flow is from left to right and top to bottom.</div><div class="line">      //</div><div class="line">      // We start out with all worker chares contributing their porition of the</div><div class="line">      // global row IDs that each work on. This is labelled ChRow. The worker</div><div class="line">      // chares also contribute, in parallel, their portion of the global node</div><div class="line">      // ID lists at which they can set boundary conditions, labelled, ChBCs.</div><div class="line">      // Once both row IDs and BC node lists are received on LinSysMerger, we do</div><div class="line">      // a global reduction to Transport::rowcomplete() spawns two broadcasts:</div><div class="line">      // (1) to LinSysMerger::rowsreceived(), and (2) to worker::setup().</div><div class="line">      //</div><div class="line">      // The member function tk::LinSysMerger::rowsreceived(), labeled Ver in</div><div class="line">      // the task-graph, triggers and performs a number tasks: (1) Verification</div><div class="line">      // that ensures consistent global row IDs, labeled VerRow. This step only</div><div class="line">      // happens in DEBUG mode: VerRow is simply an Assert in member function</div><div class="line">      // rowsreceived). (2) Verification of the boundary contitions to be set</div><div class="line">      // that they match those set by the user, labeled VerBCs. While this step</div><div class="line">      // only happens in DEBUG mode, it involves multiple steps of communication</div><div class="line">      // via multiple functions calls across three classes, LinSysMerger, host,</div><div class="line">      // and worker. Note that this also involves multiple global reductions to</div><div class="line">      // host originating from both the worker chares as well as from the</div><div class="line">      // LinSysMerger group. Thus VerBCs is a global synchronization point and</div><div class="line">      // thus colored and filled on the task-graph. The VerBCs code-path</div><div class="line">      // culminates in tk::LinSysMerger::ver_complete(). Note both primary and</div><div class="line">      // auxiliary solution updates, labeled Upd and AuxUpd, respectively,</div><div class="line">      // depend on ver_complete(). While this is is not strictly necessary from</div><div class="line">      // the correctness viewpoint, these dependencies are used to prevent the</div><div class="line">      // runtime system prematurely scheduling other reductions that these</div><div class="line">      // updates trigger in the worker chares, e.g., as a result of</div><div class="line">      // inciter::Carrier::aec() and inciter::Carrier::alwd(). As to why it</div><div class="line">      // is a problem to have multiple reductions in flight directed towards the</div><div class="line">      // same host objects see the discussion at</div><div class="line">      // https://lists.cs.illinois.edu/lists/arc/charm/2016-07/msg00033.html.</div><div class="line">      // (3) The third task, tk::LinSysMerger::rowsreceived() initiates is</div><div class="line">      // labeled QueryBCVal. This initiates querying boundary condition values</div><div class="line">      // from worker chares. This step culminates is triggering the SDAG signals</div><div class="line">      // bcval_complete(), which is a prerequisite for setting boundary</div><div class="line">      // conditions on both left and right hand sides of both the auxiliary and</div><div class="line">      // the primary linear systems. (4) The final step,</div><div class="line">      // tk::LinSysMerger::rowsreceived() initiates is building Hypre data from</div><div class="line">      // the global row indices received, labeled HypreRow.</div><div class="line"></div><div class="line">      // Once the row IDs are contributed, tk::Transporter::rowcomplete(), not</div><div class="line">      // only spaws tk::LinSysMerger::rowsreceived() but also issues a broadcast</div><div class="line">      // to the worker chares to start initializing their system. This is</div><div class="line">      // started with a call to the init() member function of the worker. The</div><div class="line">      // tasks include setting initial conditions, sending unknown/solution</div><div class="line">      // vectors for assembly to LinSysMerger, start computing the left and</div><div class="line">      // right hand sides for both the primary and auxiliary systems, and</div><div class="line">      // sending all this for linear system assembly. All worker chares</div><div class="line">      // contribute their portion of the solution (unknown) vector, the nonzero</div><div class="line">      // values of the left hand side matrix, their portion of the (diagonal)</div><div class="line">      // auxiliary matrix, the right hand side vector for the primary system, as</div><div class="line">      // well as for the auxiliary rhs term that is combined with the rhs of the</div><div class="line">      // primary linear system to create the auxiliary system rhs.  The</div><div class="line">      // contribution goes to those Linear System Merger group branch (one per</div><div class="line">      // CPU) the workers happen to reside on. These steps are denoted by ChSol,</div><div class="line">      // ChLhs, ChRhs, ChAuxLhs, and ChAuxRhs in the graph above, and the</div><div class="line">      // contributions/assembly is performed by the member functions charesol(),</div><div class="line">      // charelhs(), charerhs(), chareauxlhs(), and chareauxrhs(), respectively.</div><div class="line">      //</div><div class="line">      // Primary solution only: Once each of the tasks, ChSol, ChLhs, ChRhs,</div><div class="line">      // (not all at the same time but separately) are done, we continue by</div><div class="line">      // converting these data structures to a format that Hypre expects, done</div><div class="line">      // in hypresol(), hyprelhs(), and hyprerhs(), denoted by similars labels</div><div class="line">      // in the graph. These functions basically flatten the C++ data</div><div class="line">      // structures to C-style arrays and linked arrays (for the matrix). Note</div><div class="line">      // that the left and right hand sides can only begin to be converted to</div><div class="line">      // Hypre data format if the boundary conditions have also been applied on</div><div class="line">      // each. These are labeled LhsBC, RhsBC, and LumpBC and computed after</div><div class="line">      // QueryBCVal has finished.</div><div class="line">      //</div><div class="line">      // Primary solution only: Once the tasks, HypreSol, HypreLhs, HypreRhs,</div><div class="line">      // (not all at the same time but separately) are done and the Hypre data</div><div class="line">      // structure for the row IDs are complete, we continue by assigning the</div><div class="line">      // flattened data structures (more precisely, their pointers) to the Hypre</div><div class="line">      // vectors and Hypre matrix.  These are denoted FillSol, FillLhs, and</div><div class="line">      // FillRhs in the DAG and correspond to the member functions sol(), lhs(),</div><div class="line">      // and rhs().</div><div class="line">      //</div><div class="line">      // Primary solution only: Once the tasks, FillSol, FillLhs, FIllRhs, (not</div><div class="line">      // all at the same time, but separately) are, we continue by calling the</div><div class="line">      // Hypre &quot;assembly&quot; routines for the solution vector, the left hand side</div><div class="line">      // matrix, and the right hand side vector. These are denoted by AsmSol,</div><div class="line">      // AsmLhs, and AsmRhs in the DAG, and performed by the member functions</div><div class="line">      // assemblesol(), assemblelhs(), and assemblerhs(), respectively.</div><div class="line">      //</div><div class="line">      // Primary solution only: Once the assembly of the solution (unknown)</div><div class="line">      // vector, the left hand side matrix, and the right hand side vector are</div><div class="line">      // all done (on a CPU), labels AsmSol, AsmLhs, AsmRhs, respectively, we</div><div class="line">      // call the solve() member function which solves the primary linear system</div><div class="line">      // by calling Hypre and also updates the primary solution, i.e.,</div><div class="line">      // propagates the new solution back to the worker chares, labeled Upd.</div><div class="line">      //</div><div class="line">      // Auxiliary solution only: The auxiliary solution is performed once the</div><div class="line">      // primary right hand side vector, the auxiliary rhs vector (combined with</div><div class="line">      // primary the rhs), and the auxiliary lhs are all complete. The solution</div><div class="line">      // of the auxiliary system is a simple back-substitution, since the system</div><div class="line">      // is assumed diagonal.</div><div class="line">      //</div><div class="line">      // Note that propagating the new primary and auxiliary solutions only</div><div class="line">      // happen if not only the solutions are finished, but alse when the</div><div class="line">      // optional verification step is completed. As discussed above this is</div><div class="line">      // required so that we do not end up with multiple reductions in flight at</div><div class="line">      // the same time.  If these were not in place, the strict ordering of each</div><div class="line">      // CPU contributing to multiple reductions could not be guaranteed. See</div><div class="line">      // also the discussion on the charm email list linked above.</div><div class="line">      //</div><div class="line">      // A word on multiple invokation of SDAG triggers: As the commit message</div><div class="line">      // of b79ea29 explains, the &quot;triggers&quot;, such as hyprerow_complete(),</div><div class="line">      // enumerated below, at threir call site should be thought of as messages</div><div class="line">      // being put in some message queue and consumed at when clauses wherever</div><div class="line">      // they appear. If they appear in multiple when clauses, they consume</div><div class="line">      // multple messages, thus they have to be triggered multiple times. See</div><div class="line">      // also</div><div class="line">      // https://lists.cs.illinois.edu/lists/arc/charm/2016-09/msg00002.html.</div><div class="line">      //</div><div class="line">      // As discussed in src/LinSys/LinSysMerger.h, the SDAG logic discussed</div><div class="line">      // here is the same regardless whether an auxiliary linear solution is</div><div class="line">      // performed.</div><div class="line"></div><div class="line">      entry void wait4row() {</div><div class="line">        when row_complete(), bc_complete() serial &quot;row&quot; {</div><div class="line">          signal2host_row_complete( m_host ); } };</div><div class="line"></div><div class="line">      entry void wait4lhsbc() {</div><div class="line">        when lhs_complete(), bcval_complete() serial &quot;lhsbc&quot; { lhsbc(); } };</div><div class="line">      entry void wait4rhsbc() {</div><div class="line">        when rhs_complete(), bcval_complete() serial &quot;rhsbc&quot; { rhsbc(); } };</div><div class="line">      entry void wait4auxbc() {</div><div class="line">        when auxlhs_complete(), bcval_complete() serial &quot;auxbc&quot; { auxbc(); } };</div><div class="line"></div><div class="line">      entry void wait4sol() {</div><div class="line">        when sol_complete() serial &quot;hypresol&quot; { hypresol(); } };</div><div class="line">      entry void wait4lhs() {</div><div class="line">        when lhsbc_complete() serial &quot;hyprelhs&quot; { hyprelhs(); } };</div><div class="line">      entry void wait4rhs() {</div><div class="line">        when rhsbc_complete() serial &quot;hyprerhs&quot; { hyprerhs(); } };</div><div class="line"></div><div class="line">      entry void wait4hypresol() {</div><div class="line">        when hypresol_complete(), hyprerow_complete() serial &quot;sol&quot; { sol(); } };</div><div class="line">      entry void wait4hyprelhs() {</div><div class="line">        when hyprelhs_complete(), hyprerow_complete() serial &quot;lhs&quot; { lhs(); } };</div><div class="line">      entry void wait4hyprerhs() {</div><div class="line">        when hyprerhs_complete(), hyprerow_complete() serial &quot;rhs&quot; { rhs(); } };</div><div class="line"></div><div class="line">      entry void wait4fillsol() {</div><div class="line">        when fillsol_complete() serial &quot;asmsol&quot; { assemblesol(); } };</div><div class="line">      entry void wait4filllhs() {</div><div class="line">        when filllhs_complete() serial &quot;asmlhs&quot; { assemblelhs(); } };</div><div class="line">      entry void wait4fillrhs() {</div><div class="line">        when fillrhs_complete() serial &quot;asmrhs&quot; { assemblerhs(); } };</div><div class="line"></div><div class="line">      entry void wait4asm() {</div><div class="line">        when asmsol_complete(), asmlhs_complete(), asmrhs_complete()</div><div class="line">          serial &quot;solve&quot; { solve(); } };</div><div class="line">      entry void wait4aux() {</div><div class="line">        when rhs_complete(), auxrhs_complete(), auxbc_complete()</div><div class="line">          serial &quot;aux&quot; { auxsolve(); } };</div><div class="line"></div><div class="line">      entry void wait4solve() {</div><div class="line">        when solve_complete(), ver_complete() serial &quot;update&quot; {</div><div class="line">          updateSol(); } };</div><div class="line">      entry void wait4auxsolve() {</div><div class="line">        when auxsolve_complete(), ver_complete() serial &quot;updateaux&quot; {</div><div class="line">          updateAuxSol(); } };</div><div class="line"></div><div class="line">      entry void row_complete();</div><div class="line">      entry void bc_complete();</div><div class="line">      entry void bcval_complete();</div><div class="line">      entry void lhsbc_complete();</div><div class="line">      entry void rhsbc_complete();</div><div class="line">      entry void auxbc_complete();</div><div class="line">      entry void ver_complete();</div><div class="line">      entry void hyprerow_complete();</div><div class="line">      entry void lhs_complete();</div><div class="line">      entry void rhs_complete();</div><div class="line">      entry void sol_complete();</div><div class="line">      entry void auxrhs_complete();</div><div class="line">      entry void auxlhs_complete();</div><div class="line">      entry void hyprelhs_complete();</div><div class="line">      entry void hyprerhs_complete();</div><div class="line">      entry void hypresol_complete();</div><div class="line">      entry void filllhs_complete();</div><div class="line">      entry void fillrhs_complete();</div><div class="line">      entry void fillsol_complete();</div><div class="line">      entry void asmlhs_complete();</div><div class="line">      entry void asmrhs_complete();</div><div class="line">      entry void asmsol_complete();</div><div class="line">      entry void solve_complete();</div><div class="line">      entry void auxsolve_complete();</div><div class="line">    };</div><div class="line"></div><div class="line">  } // tk::</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> 
<p>Definition in file <a class="el" href="_lin_sys_merger_8h_source.html">LinSysMerger.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a6ec0c67374eb34a66c0f5ca4ecd7d163"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CK_TEMPLATES_ONLY</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_lin_sys_merger_8h_source.html#l01308">1308</a> of file <a class="el" href="_lin_sys_merger_8h_source.html">LinSysMerger.h</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_3ca9c9eb36ab3ecb75ba69910724f6da.html">LinSys</a></li><li class="navelem"><a class="el" href="_lin_sys_merger_8h.html">LinSysMerger.h</a></li>
    <li class="footer">Generated on Sat Oct 15 2016 04:42:18 for Quinoa by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
